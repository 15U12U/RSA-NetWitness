<!--
    - NXLog : Windows Event Logs : JSON Decoder
    - Author : Isuru Tharanga
-->

<!-- NXLog JSON Windows Logs Identifier -->

<!-- 2020 Dec 31 17:52:12 HOST.EXAMPLE.COM->10.150.10.250 Dec 31 17:52:15 HOST.EXAMPLE.COM Microsoft-Windows-Security-Auditing[884]: {"EventTime":"2020-12-31 17:52:15","Hostname":"HOST.EXAMPLE.COM","Keywords":-9214364837600034816,"EventType":"AUDIT_SUCCESS","SeverityValue":2,"Severity":"INFO","EventID":4624,"SourceName":"Microsoft-Windows-Security-Auditing","ProviderGuid":"{54849625-5478-4994-A5BA-3E3B0328C30D}","Version":2,"Task":12544,"OpcodeValue":0,"RecordNumber":2903583,"ActivityID":"{5353EEC0-DF1F-0001-31EF-53531FDFD601}","ProcessID":884,"ThreadID":2972,"Channel":"Security","Message":"An account was successfully logged on.|Subject:|Security ID: S-1-5-18|Account Name: HOST$|Account Domain: EXAMPLE|Logon ID: 0x3E7|Logon Information:|Logon Type: 5|Restricted Admin Mode: -|Virtual Account: No|Elevated Token: Yes|Impersonation Level: Impersonation|New Logon:|Security ID: S-1-5-18|Account Name: SYSTEM|Account Domain: NT AUTHORITY|Logon ID: 0x3E7|Linked Logon ID: 0x0|Network Account Name: -|Network Account Domain: -|Logon GUID: {00000000-0000-0000-0000-000000000000}|Process Information:|Process ID: 0x318|Process Name: C:\\Windows\\System32\\services.exe|Network Information:|Workstation Name: -|Source Network Address: -|Source Port: -|Detailed Authentication Information:|Logon Process: Advapi  |Authentication Package: Negotiate|Transited Services: -|Package Name (NTLM only): -|Key Length: 0|This event is generated when a logon session is created. It is generated on the computer that was accessed.|The subject fields indicate the account on the local system which requested the logon. This is most commonly a service such as the Server service, or a local process such as Winlogon.exe or Services.exe.|The logon type field indicates the kind of logon that occurred. The most common types are 2 (interactive) and 3 (network).|The New Logon fields indicate the account for whom the new logon was created, i.e. the account that was logged on.|The network fields indicate where a remote logon request originated. Workstation name is not always available and may be left blank in some cases.|The impersonation level field indicates the extent to which a process in the logon session can impersonate.|The authentication information fields provide detailed information about this specific logon request.|- Logon GUID is a unique identifier that can be used to correlate this event with a KDC event.|- Transited services indicate which intermediate services have participated in this logon request.|- Package name indicates which sub-protocol was used among the NTLM protocols.|- Key length indicates the length of the generated session key. This will be 0 if no session key was requested.","Category":"Logon","Opcode":"Info","SubjectUserSid":"S-1-5-18","SubjectUserName":"HOST$","SubjectDomainName":"EXAMPLE","SubjectLogonId":"0x3e7","TargetUserSid":"S-1-5-18","TargetUserName":"SYSTEM","TargetDomainName":"NT AUTHORITY","TargetLogonId":"0x3e7","LogonType":"5","LogonProcessName":"Advapi  ","AuthenticationPackageName":"Negotiate","WorkstationName":"-","LogonGuid":"{00000000-0000-0000-0000-000000000000}","TransmittedServices":"-","LmPackageName":"-","KeyLength":"0","ProcessName":"C:\\Windows\\System32\\services.exe","IpAddress":"-","IpPort":"-","ImpersonationLevel":"%%1833","RestrictedAdminMode":"-","TargetOutboundUserName":"-","TargetOutboundDomainName":"-","VirtualAccount":"%%1843","TargetLinkedLogonId":"0x0","ElevatedToken":"%%1842","EventReceivedTime":"2020-12-31 17:52:16","SourceModuleName":"winsecurity","SourceModuleType":"im_msvistalog"} -->

<decoder name="nxlog-json-win-security">
    <program_name>Microsoft-Windows-Security-Auditing</program_name>
    <plugin_decoder>JSON_Decoder</plugin_decoder>
</decoder>


<!-- Sample Log : 2020 Dec 31 16:36:04 HOST.EXAMPLE.COM->10.150.10.250 Dec 31 16:36:06 HOST.EXAMPLE.COM Microsoft-Windows-Sysmon[11136]: {"EventTime":"2020-12-31 16:36:06","Hostname":"HOST.EXAMPLE.COM","Keywords":-9223372036854775808,"EventType":"INFO","SeverityValue":2,"Severity":"INFO","EventID":8,"SourceName":"Microsoft-Windows-Sysmon","ProviderGuid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Version":2,"Task":8,"OpcodeValue":0,"RecordNumber":124,"ProcessID":11136,"ThreadID":12088,"Channel":"Microsoft-Windows-Sysmon/Operational","Domain":"NT AUTHORITY","AccountName":"SYSTEM","UserID":"S-1-5-18","AccountType":"User","Message":"CreateRemoteThread detected: RuleName: - UtcTime: 2020-12-31 11:06:06.534 SourceProcessGuid: {487c90b8-3c11-5fed-6500-000000001b00} SourceProcessId: 5212 SourceImage: C:\\Program Files\\Common Files\\McAfee\\SystemCore\\mfehcs.exe TargetProcessGuid: {487c90b8-b09e-5fed-4c04-000000001b00} TargetProcessId: 12156 TargetImage: C:\\Program Files\\Microsoft Policy Platform\\policyHost.exe NewThreadId: 12424 StartAddress: 0x0000000000840000 StartModule: - StartFunction: -","Category":"CreateRemoteThread detected (rule: CreateRemoteThread)","Opcode":"Info","RuleName":"-","UtcTime":"2020-12-31 11:06:06.534","SourceProcessGuid":"{487c90b8-3c11-5fed-6500-000000001b00}","SourceProcessId":"5212","SourceImage":"C:\\Program Files\\Common Files\\McAfee\\SystemCore\\mfehcs.exe","TargetProcessGuid":"{487c90b8-b09e-5fed-4c04-000000001b00}","TargetProcessId":"12156","TargetImage":"C:\\Program Files\\Microsoft Policy Platform\\policyHost.exe","NewThreadId":"12424","StartAddress":"0x0000000000840000","StartModule":"-","StartFunction":"-","EventReceivedTime":"2020-12-31 16:36:08","SourceModuleName":"winsysmon","SourceModuleType":"im_msvistalog"} -->

<decoder name="nxlog-json-win-sysmon">
    <program_name>Microsoft-Windows-Sysmon</program_name>
    <plugin_decoder>JSON_Decoder</plugin_decoder>
</decoder>

