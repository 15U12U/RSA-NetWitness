<!-- Author: Isuru Tharanga Malawige
     Github: 15u12u
     Description: A parser for SWIFT CEF log messages (Alliance Access, Alliance Gateway, Alliance Web Platform)
-->

<!--
Feb 7  14:12:25 localhost WS_appsrv: CEF:0|SWIFT|Alliance Access|7.6.8|BSA-3000|Successful signon|Low|cn1=2147383691 cn1Label=Event Sequence ID cs1=2bf40d46-125a-46e0-ac10-1cb064fd9d65 cs1Label=Instance UUID cs2=2bf40d46-125a-46e0-ac10-1cb064fd9d65 cs2Label=Correlation ID cat=Operator msg=Operator RSO : Right Security Officer, Locally Authenticated - successfully signed on to the terminal 'X.X.X.X@2' at 14:12:25 (UTC +05:30) using 'Alliance Web Platform'.\n suid=RSO dvchost=localhost.localdomain dvc=0.0.0.0 dvcmac= deviceProcessName=WS_appsrv src=X.X.X.X dtz=Asia/Colombo rt=1675759345000 outcome=Success
Feb 7  14:24:09 localhost swpservice: CEF:0|SWIFT|Alliance Web Platform|7.6.00|10006|logout.success|Low|cn1=566 cn1Label=Event Sequence ID cs1=2bf40d46-125a-46e0-ac10-1cb064fd9d65 cs1Label=Instance UUID cs3=Y.Y.Y.Y cs3Label=Proxy IP cat=Security msg=User swpadmin logged out successfully from application group Alliance Web Platform Administration 7.6. suid=swpadmin dvchost= dvc=localhost dvcmac= deviceProcessName=swpservice src=Y.Y.Y.Y dtz=Asia/Colombo rt=1675759345000
CEF:0|SWIFT|Alliance Access|7.6.8|BSA-3000|Successful signon|Low|cn1=2147383691 cn1Label=Event Sequence ID cs1=2bf40d46-125a-46e0-ac10-1cb064fd9d65 cs1Label=Instance UUID cs2=2bf40d46-125a-46e0-ac10-1cb064fd9d65 cs2Label=Correlation ID cat=Operator msg=Operator RSO : Right Security Officer, Locally Authenticated - successfully signed on to the terminal 'X.X.X.X@2' at 14:12:25 (UTC +05:30) using 'Alliance Web Platform'.\n suid=RSO dvchost=localhost.localdomain dvc=0.0.0.0 dvcmac= deviceProcessName=WS_appsrv src=X.X.X.X dtz=Asia/Colombo rt=1675759345000 outcome=Success
Feb 7  14:24:09 localhost CEF:0|SWIFT|Alliance Web Platform|7.6.00|10006|logout.success|Low|cn1=566 cn1Label=Event Sequence ID cs1=2bf40d46-125a-46e0-ac10-1cb064fd9d65 cs1Label=Instance UUID cs3=Y.Y.Y.Y cs3Label=Proxy IP cat=Security msg=User swpadmin logged out successfully from application group Alliance Web Platform Administration 7.6. suid=swpadmin dvchost= dvc=localhost dvcmac= deviceProcessName=swpservice src=Y.Y.Y.Y dtz=Asia/Colombo rt=1675759345000
Feb 7  14:12:25 CEF:0|SWIFT|Alliance Access|7.6.8|BSA-3000|Successful signon|Low|cn1=2147383691 cn1Label=Event Sequence ID cs1=2bf40d46-125a-46e0-ac10-1cb064fd9d65 cs1Label=Instance UUID cs2=2bf40d46-125a-46e0-ac10-1cb064fd9d65 cs2Label=Correlation ID cat=Operator msg=Operator RSO : Right Security Officer, Locally Authenticated - successfully signed on to the terminal 'X.X.X.X@2' at 14:12:25 (UTC +05:30) using 'Alliance Web Platform'.\n suid=RSO dvchost=localhost.localdomain dvc=0.0.0.0 dvcmac= deviceProcessName=WS_appsrv src=X.X.X.X dtz=Asia/Colombo rt=1675759345000 outcome=Success
Feb 7  14:24:09 swpservice: CEF:0|SWIFT|Alliance Web Platform|7.6.00|10006|logout.success|Low|cn1=566 cn1Label=Event Sequence ID cs1=2bf40d46-125a-46e0-ac10-1cb064fd9d65 cs1Label=Instance UUID cs3=Y.Y.Y.Y cs3Label=Proxy IP cat=Security msg=User swpadmin logged out successfully from application group Alliance Web Platform Administration 7.6. suid=swpadmin dvchost= dvc=localhost dvcmac= deviceProcessName=swpservice src=Y.Y.Y.Y dtz=Asia/Colombo rt=1675759345000
<181>Feb 7  14:24:09 swpservice: CEF:0|SWIFT|Alliance Web Platform|7.6.00|10006|logout.success|Low|cn1=566 cn1Label=Event Sequence ID cs1=2bf40d46-125a-46e0-ac10-1cb064fd9d65 cs1Label=Instance UUID cs3=Y.Y.Y.Y cs3Label=Proxy IP cat=Security msg=User swpadmin logged out successfully from application group Alliance Web Platform Administration 7.6. suid=swpadmin dvchost= dvc=localhost dvcmac= deviceProcessName=swpservice src=Y.Y.Y.Y dtz=Asia/Colombo rt=1675759345000
<181>Feb 7  14:12:25 localhost WS_appsrv: CEF:0|SWIFT|Alliance Access|7.6.8|BSA-3000|Successful signon|Low|cn1=2147383691 cn1Label=Event Sequence ID cs1=2bf40d46-125a-46e0-ac10-1cb064fd9d65 cs1Label=Instance UUID cs2=2bf40d46-125a-46e0-ac10-1cb064fd9d65 cs2Label=Correlation ID cat=Operator msg=Operator RSO : Right Security Officer, Locally Authenticated - successfully signed on to the terminal 'X.X.X.X@2' at 14:12:25 (UTC +05:30) using 'Alliance Web Platform'.\n suid=RSO dvchost=localhost.localdomain dvc=0.0.0.0 dvcmac= deviceProcessName=WS_appsrv src=X.X.X.X dtz=Asia/Colombo rt=1675759345000 outcome=Success
<181>Feb 7  14:24:09 localhost CEF:0|SWIFT|Alliance Web Platform|7.6.00|10006|logout.success|Low|cn1=566 cn1Label=Event Sequence ID cs1=2bf40d46-125a-46e0-ac10-1cb064fd9d65 cs1Label=Instance UUID cs3=Y.Y.Y.Y cs3Label=Proxy IP cat=Security msg=User swpadmin logged out successfully from application group Alliance Web Platform Administration 7.6. suid=swpadmin dvchost= dvc=localhost dvcmac= deviceProcessName=swpservice src=Y.Y.Y.Y dtz=Asia/Colombo rt=1675759345000
<181>Feb 7  14:24:09 CEF:0|SWIFT|Alliance Web Platform|7.6.00|10006|logout.success|Low|cn1=566 cn1Label=Event Sequence ID cs1=2bf40d46-125a-46e0-ac10-1cb064fd9d65 cs1Label=Instance UUID cs3=Y.Y.Y.Y cs3Label=Proxy IP cat=Security msg=User swpadmin logged out successfully from application group Alliance Web Platform Administration 7.6. suid=swpadmin dvchost= dvc=localhost dvcmac= deviceProcessName=swpservice src=Y.Y.Y.Y dtz=Asia/Colombo rt=1675759345000
<181>CEF:0|SWIFT|Alliance Web Platform|7.6.00|10006|logout.success|Low|cn1=566 cn1Label=Event Sequence ID cs1=2bf40d46-125a-46e0-ac10-1cb064fd9d65 cs1Label=Instance UUID cs3=Y.Y.Y.Y cs3Label=Proxy IP cat=Security msg=User swpadmin logged out successfully from application group Alliance Web Platform Administration 7.6. suid=swpadmin dvchost= dvc=localhost dvcmac= deviceProcessName=swpservice src=Y.Y.Y.Y dtz=Asia/Colombo rt=1675759345000
-->

<eventFormatRecognizer><![CDATA[CEF:\d+\|SWIFT\|]]></eventFormatRecognizer>
<parsingInstructions>
    <switch>
        <case>
            <collectFieldsByRegex src="$_rawmsg">
                <regex><![CDATA[^<:gPatSyslogPRI>?\s*<_mon:gPatMon>\s+<_day:gPatDay>\s+<_time:gPatTime>\s+<:gPatStr>\s+<:gPatStr>:\s+CEF:<_body:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
            <setEventAttribute attr="deviceTime">toDateTime($_mon, $_day, $_time)</setEventAttribute>
        </case>
        <case>
            <collectFieldsByRegex src="$_rawmsg">
                <regex><![CDATA[^<:gPatSyslogPRI>?\s*<_mon:gPatMon>\s+<_day:gPatDay>\s+<_time:gPatTime>\s+<:gPatStr>\s+CEF:<_body:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
            <setEventAttribute attr="deviceTime">toDateTime($_mon, $_day, $_time)</setEventAttribute>
        </case>
        <case>
            <collectFieldsByRegex src="$_rawmsg">
                <regex><![CDATA[^<:gPatSyslogPRI>?\s*<_mon:gPatMon>\s+<_day:gPatDay>\s+<_time:gPatTime>\s+<:gPatStr>:\s+CEF:<_body:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
            <setEventAttribute attr="deviceTime">toDateTime($_mon, $_day, $_time)</setEventAttribute>
        </case>
        <case>
            <collectFieldsByRegex src="$_rawmsg">
                <regex><![CDATA[^<:gPatSyslogPRI>?\s*<_mon:gPatMon>\s+<_day:gPatDay>\s+<_time:gPatTime>\s+CEF:<_body:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
            <setEventAttribute attr="deviceTime">toDateTime($_mon, $_day, $_time)</setEventAttribute>
        </case>
        <default>
            <collectFieldsByRegex src="$_rawmsg">
                <regex><![CDATA[^<:gPatSyslogPRI>?\s*CEF:<_body:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
        </default>
    </switch>
    <collectAndSetAttrByPos sep="|" src="$_body">
        <attrPosMap attr="_version" pos="1"/>
        <attrPosMap attr="_devVendor" pos="2"/>
        <attrPosMap attr="_devProduct" pos="3"/>
        <attrPosMap attr="appVersion" pos="4"/>
        <attrPosMap attr="_sigId" pos="5"/>
        <attrPosMap attr="categoryType" pos="6"/>
        <attrPosMap attr="_severity" pos="7"/>
        <attrPosMap attr="_extension" pos="8"/>
    </collectAndSetAttrByPos>
    <setEventAttribute attr="reptVendor">$_devVendor</setEventAttribute>
    <setEventAttribute attr="reptModel">$_devProduct</setEventAttribute>
    <setEventAttribute attr="signatureName">$_sigId</setEventAttribute>
    <setEventAttribute attr="eventSeverity">$_severity</setEventAttribute>
    <setEventAttribute attr="_extension">replaceStrInStr($_extension, "\=", "=")</setEventAttribute>
    <collectFieldsByKeyValuePair kvsep="=" sep=" " src="$_extension">
        <attrKeyMap attr="_cn1" key="cn1"/>
        <attrKeyMap attr="_cn1Label" key="cn1Label"/>
        <attrKeyMap attr="_cs1" key="cs1"/>
        <attrKeyMap attr="_cs1Label" key="cs1Label"/>
        <attrKeyMap attr="_cs2" key="cs1"/>
        <attrKeyMap attr="_cs2Label" key="cs2Label"/>
        <attrKeyMap attr="_cs3" key="cs3"/>
        <attrKeyMap attr="_cs3Label" key="cs3Label"/> 
        <attrKeyMap attr="msg" key="msg"/>
        <attrKeyMap attr="operatorName" key="suid"/>
        <attrKeyMap attr="hostName" key="dvchost"/>
        <attrKeyMap attr="devEventTypeGrp" key="cat"/>
        <attrKeyMap attr="_hostIpAddr" key="dvc"/>
        <attrKeyMap attr="hostMACAddr" key="dvcmac"/>
        <attrKeyMap attr="procName" key="deviceProcessName"/>
        <attrKeyMap attr="destName" key="dhost"/>
        <attrKeyMap attr="destIpAddr" key="dst"/>
        <attrKeyMap attr="srcName" key="shost"/>
        <attrKeyMap attr="srcIpAddr" key="src"/>
        <attrKeyMap attr="srcTimeZone" key="dtz"/>
        <attrKeyMap attr="_rt" key="rt"/>
        <attrKeyMap attr="_eventAction" key="outcome"/>
    </collectFieldsByKeyValuePair>
    <choose>
        <when test="not_exist _cn1Label"/>
        <when test="not_exist _cn1"/>
        <when test="not_exist _cs1Label"/>
        <when test="not_exist _cs1"/>
        <when test="not_exist _cs2Label"/>
        <when test="not_exist _cs2"/>
        <when test="not_exist _cs3Label"/>
        <when test="not_exist _cs3"/>
        <when test="$_cn1Label = 'Event Sequence ID'">
            <setEventAttribute attr="seqNum">$_cn1</setEventAttribute>
        </when>
        <when test="$_cs1Label = 'Instance UUID'">
            <setEventAttribute attr="uuid">$_cs1</setEventAttribute>
        </when>
        <when test="$_cs2Label = 'Correlation ID'">
            <setEventAttribute attr="correlationID">$_cs2</setEventAttribute>
        </when>
        <when test="$_cs3Label = 'Proxy IP'">
            <setEventAttribute attr="proxyIP">$_cs3</setEventAttribute>
        </when>
    </choose>
    <choose>
        <when test="exist categoryType">
            <setEventAttribute attr="eventType">combineMsgId($_devProduct, " - ", $categoryType)</setEventAttribute>
        </when>
        <otherwise>
            <setEventAttribute attr="eventType">combineMsgId($_devProduct, "- Generic")</setEventAttribute>
        </otherwise>
    </choose>
    <choose>
        <when test="exist _rt">
            <switch>
                <case>
                    <collectFieldsByRegex src="$_rt">
                        <regex><![CDATA[<_mon1:gPatMon>\s+<_day1:gPatDay>\s+<_year1:gPatYear>\s+<_time1:gPatTime>]]></regex>
                    </collectFieldsByRegex>
                    <setEventAttribute attr="eventTime">toDateTime($_mon1, $_day1, $_year1, $_time1)</setEventAttribute>
                </case>
                <case>
                    <collectFieldsByRegex src="$_rt">
                        <regex><![CDATA[^<eventTime:gPatInt>\d{3}$]]></regex>
                    </collectFieldsByRegex>
                </case>
            </switch>
        </when>
    </choose>
</parsingInstructions>
